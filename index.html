<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Svetainƒó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: #667eea;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .info-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .name-setup {
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
        }

        .name-setup h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .name-setup input {
            padding: 12px;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            width: 250px;
            max-width: 100%;
        }

        .name-setup button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .name-setup button:hover {
            background: #5a6fd8;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.own {
            background: #667eea;
            color: white;
            margin-left: 50px;
        }

        .message.own .username {
            color: #e3e8ff;
        }

        .message .username {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message .timestamp {
            font-size: 11px;
            opacity: 0.7;
            font-weight: normal;
        }

        .message .content {
            margin-top: 8px;
            line-height: 1.4;
        }

        .message img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            margin-top: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .message img:hover {
            transform: scale(1.02);
        }

        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            min-height: 44px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn, .image-btn {
            padding: 12px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: background 0.3s;
        }

        .send-btn:hover, .image-btn:hover {
            background: #5a6fd8;
        }

        .hidden {
            display: none;
        }

        .online-users {
            padding: 12px 20px;
            background: #e9ecef;
            border-top: 1px solid #ddd;
            font-size: 14px;
        }

        .online-users strong {
            color: #667eea;
        }

        #fileInput {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal img {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            margin-top: 5%;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ccc;
        }

        .empty-chat {
            text-align: center;
            color: #666;
            margin-top: 50px;
            font-style: italic;
        }

        .typing-indicator {
            padding: 10px;
            font-style: italic;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .message.own {
                margin-left: 20px;
            }
            
            .name-setup input {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí¨ Chat Svetainƒó</h1>
            <div class="info-badge">Duomenys nesaugomi</div>
        </div>

        <div id="nameSetup" class="name-setup">
            <h2>ƒÆveskite savo vardƒÖ</h2>
            <input type="text" id="usernameInput" placeholder="J≈´s≈≥ vardas..." maxlength="20">
            <button onclick="setUsername()">Prisijungti</button>
        </div>

        <div id="chatContainer" class="chat-container hidden">
            <div class="messages" id="messages">
                <div class="empty-chat">
                    Chat tu≈°ƒçias. B≈´kite pirmieji para≈°ƒô ≈æinutƒô! üëã
                </div>
            </div>
            <div class="online-users">
                <strong>Prisijungƒô dabar:</strong> <span id="onlineUsersList">Tu</span>
            </div>
            <div class="input-area">
                <textarea id="messageInput" class="message-input" placeholder="Para≈°ykite ≈æinutƒô..." rows="1"></textarea>
                <input type="file" id="fileInput" accept="image/*" onchange="uploadImage()">
                <button class="image-btn" onclick="document.getElementById('fileInput').click()" title="ƒÆkelti nuotraukƒÖ">üì∑</button>
                <button class="send-btn" onclick="sendMessage()">Si≈≥sti</button>
            </div>
        </div>
    </div>

    <!-- Modal nuotrauk≈≥ per≈æi≈´rai -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close">&times;</span>
        <img id="modalImage" src="" alt="">
    </div>

    <script>
        // Global≈´s kintamieji
        let currentUser = '';
        let messages = [];
        let onlineUsers = new Set();

        // Prisijungimas
        function setUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username.length === 0) {
                alert('Pra≈°ome ƒØvesti vardƒÖ!');
                return;
            }
            if (username.length > 20) {
                alert('Vardas per ilgas! Maksimalus ilgis - 20 simboli≈≥.');
                return;
            }

            currentUser = username;
            onlineUsers.add(username);
            
            document.getElementById('nameSetup').classList.add('hidden');
            document.getElementById('chatContainer').classList.remove('hidden');
            
            updateOnlineUsers();
            document.getElementById('messageInput').focus();

            // Pridƒóti prisijungimo ≈æinutƒô
            addSystemMessage(`${username} prisijungƒó prie chat'o`);
        }

        // ≈Ωinutƒós siuntimas
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            
            if (text.length === 0) return;

            const message = {
                id: Date.now(),
                username: currentUser,
                text: text,
                timestamp: new Date(),
                type: 'text'
            };

            messages.push(message);
            displayMessage(message);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            scrollToBottom();
        }

        // Sistema ≈æinutƒós pridƒójimas
        function addSystemMessage(text) {
            const message = {
                id: Date.now(),
                username: 'Sistema',
                text: text,
                timestamp: new Date(),
                type: 'system'
            };
            messages.push(message);
            displayMessage(message);
            scrollToBottom();
        }

        // ≈Ωinutƒós atvaizdavimas
        function displayMessage(message) {
            const messagesContainer = document.getElementById('messages');
            
            // Paslƒópti tu≈°ƒçio chat prane≈°imƒÖ
            const emptyChat = messagesContainer.querySelector('.empty-chat');
            if (emptyChat) {
                emptyChat.remove();
            }

            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.username === currentUser ? 'own' : ''}`;
            
            const timeString = message.timestamp.toLocaleTimeString('lt-LT', {
                hour: '2-digit',
                minute: '2-digit'
            });

            let messageContent = '';
            if (message.type === 'system') {
                messageElement.style.background = '#f0f0f0';
                messageElement.style.fontStyle = 'italic';
                messageElement.style.textAlign = 'center';
                messageContent = `<div class="content">${message.text}</div>`;
            } else if (message.type === 'image') {
                messageContent = `
                    <div class="username">
                        ${message.username}
                        <span class="timestamp">${timeString}</span>
                    </div>
                    <div class="content">
                        <img src="${message.imageData}" alt="Nuotrauka" onclick="openModal('${message.imageData}')">
                        ${message.text ? `<p>${message.text}</p>` : ''}
                    </div>
                `;
            } else {
                messageContent = `
                    <div class="username">
                        ${message.username}
                        <span class="timestamp">${timeString}</span>
                    </div>
                    <div class="content">${message.text}</div>
                `;
            }

            messageElement.innerHTML = messageContent;
            messagesContainer.appendChild(messageElement);
        }

        // Nuotraukos ƒØkƒólimas
        function uploadImage() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Pra≈°ome pasirinkti nuotraukos failƒÖ!');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB
                alert('Nuotrauka per didelƒó! Maksimalus dydis - 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const message = {
                    id: Date.now(),
                    username: currentUser,
                    text: '',
                    timestamp: new Date(),
                    type: 'image',
                    imageData: e.target.result
                };

                messages.push(message);
                displayMessage(message);
                scrollToBottom();
            };
            reader.readAsDataURL(file);
            
            // I≈°valyti input
            fileInput.value = '';
        }

        // Modal nuotrauk≈≥ per≈æi≈´rai
        function openModal(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('imageModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Online vartotoj≈≥ atnaujinimas
        function updateOnlineUsers() {
            document.getElementById('onlineUsersList').textContent = Array.from(onlineUsers).join(', ');
        }

        // Scroll ƒØ apaƒçiƒÖ
        function scrollToBottom() {
            const messagesContainer = document.getElementById('messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                const activeElement = document.activeElement;
                
                if (activeElement.id === 'usernameInput') {
                    e.preventDefault();
                    setUsername();
                } else if (activeElement.id === 'messageInput') {
                    e.preventDefault();
                    sendMessage();
                }
            }
            
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Auto-resize textarea
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // Simuliuoti kitus vartotojus (demo tikslais)
        function simulateOtherUsers() {
            const demoUsers = ['Jonas', 'Marija', 'Petras', 'Ona'];
            const demoMessages = [
                'Labas! Kaip sekasi?',
                'Gera diena visiems! ‚òÄÔ∏è',
                'Kas naujo?',
                'Puiku, kad vƒól galim bendrauti!',
                '≈†auniai atrodantis chat! üëç'
            ];

            // Pridƒóti kelis demo vartotojus
            setTimeout(() => {
                const randomUser = demoUsers[Math.floor(Math.random() * demoUsers.length)];
                if (randomUser !== currentUser) {
                    onlineUsers.add(randomUser);
                    updateOnlineUsers();
                    addSystemMessage(`${randomUser} prisijungƒó prie chat'o`);
                }
            }, 2000);

            // Kartais si≈≥sti demo ≈æinutes
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% tikimybƒó kas sekundƒô
                    const randomUser = Array.from(onlineUsers).filter(user => user !== currentUser)[0];
                    if (randomUser) {
                        const randomMessage = demoMessages[Math.floor(Math.random() * demoMessages.length)];
                        const message = {
                            id: Date.now(),
                            username: randomUser,
                            text: randomMessage,
                            timestamp: new Date(),
                            type: 'text'
                        };
                        messages.push(message);
                        displayMessage(message);
                        scrollToBottom();
                    }
                }
            }, 1000);
        }

        // Paleisti demo po prisijungimo
        document.addEventListener('DOMContentLoaded', function() {
            // Fokusas ƒØ vardo ƒØvedimo laukƒÖ
            document.getElementById('usernameInput').focus();
        });

        // Prisijungus paleisti demo
        const originalSetUsername = setUsername;
        setUsername = function() {
            originalSetUsername();
            if (currentUser) {
                setTimeout(simulateOtherUsers, 1000);
            }
        };
    </script>
</body>
</html>